dist: bionic         # Ubuntu 18.4 LTS
language: generic    # We want to test on Anaconda, not travis' stock python

# Caching the Python dependencies speeds up builds and lightens
# the load on TravisCI
cache: pip


jobs:
  include:
    - name: "Python 3.6"
      env: PYTHON=3.6
    - name: "Python 3.8"
      env: PYTHON=3.8

services:
  - mongodb

before_install:
  # Install miniconda
  - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
  - chmod +x miniconda.sh
  - ./miniconda.sh -b -p $HOME/miniconda
  - export PATH=$HOME/miniconda/bin:$PATH

  # Create environment, initially without root stuff
  - conda config --set always_yes yes --set changeps1 no
  - conda info -a # Useful for debugging any issues with conda
  - conda create -q -n pax python=${PYTHON} numpy scipy h5py pyqt matplotlib pandas cython numba pip python-snappy pytables scikit-learn psutil jupyter
  - source activate pax

  # root and root_pandas are on conda-forge
  - conda install -c conda-forge root root_pandas
  # Recent rootpy versions are only on pip... cross fingers...
  - pip install rootpy

  - pip install mongodbproxy    # Somehow needs explicit install?
  - pip install coveralls nose coverage

install:
  # - pip install -r requirements.txt    # Contains ancient pins
  - python setup.py install
  - pip freeze

  # Run a simple test file, to see if the tests load
  # If there is an import failure, you don't get to know which import is failing otherwise
  - python tests/test_maxpmt.py

# command to run tests, e.g. python setup.py test
script:
  - make test
  - make lint
