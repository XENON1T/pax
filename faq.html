<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation and setup &mdash; Processor for Analyzing XENON1T 5.3.6 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '5.3.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Processor for Analyzing XENON1T 5.3.6 documentation" href="index.html" />
    <link rel="next" title="Event format" href="format.html" />
    <link rel="prev" title="Installation prerequisites" href="readme.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation-and-setup">
<h1>Installation and setup<a class="headerlink" href="#installation-and-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup-pycharm">
<h2>Setup PyCharm<a class="headerlink" href="#setup-pycharm" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="http://docs.continuum.io/anaconda/ide_integration#pycharm">http://docs.continuum.io/anaconda/ide_integration#pycharm</a></p>
</div>
<div class="section" id="how-do-i-use-pax-at-lngs-chicago-nikhef">
<h2>How do I use <cite>pax</cite> at LNGS/Chicago/Nikhef?<a class="headerlink" href="#how-do-i-use-pax-at-lngs-chicago-nikhef" title="Permalink to this headline">¶</a></h2>
<p>We use DeployHQ to automatically deploy pax to various sites.  You can use these environments by activate the &#8216;pax_head&#8217; environment.</p>
<blockquote>
<div><ul class="simple">
<li>Gran Sasso xecluster <cite>export PATH=&#8221;/archive_lngs/common/anaconda3/bin:$PATH&#8221;</cite></li>
<li>Chicago Midway       <cite>export PATH=&#8221;/project/lgrandi/anaconda3/bin:$PATH&#8221;</cite></li>
<li>Nikhef       <cite>export PATH=&#8221;/data/xenon/anaconda/bin:$PATH&#8221;</cite></li>
</ul>
</div></blockquote>
<p>Then executing the following will activate the pax environment:</p>
<div class="highlight-python"><div class="highlight"><pre>source activate pax_head
</pre></div>
</div>
<p>More information can be found at <a class="reference external" href="https://xecluster.lngs.infn.it/dokuwiki/doku.php?id=xenon:xenon1t:analysis">https://xecluster.lngs.infn.it/dokuwiki/doku.php?id=xenon:xenon1t:analysis</a>:beginnersguide&amp;#the_tools</p>
</div>
<div class="section" id="how-do-i-develop-for-pax-at-lngs">
<h2>How do I develop for <cite>pax</cite> at LNGS?<a class="headerlink" href="#how-do-i-develop-for-pax-at-lngs" title="Permalink to this headline">¶</a></h2>
<p>To set up a developer installation of pax, first you follow the steps for installing anaconda and the required packages in the main readme (longer and more disk space). For LNGS, Then creating your own environment on xecluster01 with:</p>
<div class="highlight-python"><div class="highlight"><pre>conda create -n &lt;name_of_your_environment&gt; &lt;list_of_packages_from_main_readme_for_creating_pax_environment&gt;
</pre></div>
</div>
<p>Some additional packages are required to be installed as follows (still on xecluster01):</p>
<div class="highlight-python"><div class="highlight"><pre>cd ~
wget http://curl.haxx.se/ca/cacert.pem ~/cacert.pem
mkdir -p .pip
cp /home/aalbers/.pip/pip.conf ~/.pip
pip install avro-python3 flake8 prettytable tqdm pymongo
</pre></div>
</div>
<p>Then, to access our GitHub repository from xecluster01, add the following to your .bashrc:</p>
<div class="highlight-python"><div class="highlight"><pre># use git in totally insecure mode
export PATH=/home/kaminsky/software/bin:$PATH
export GIT_SSL_NO_VERIFY=true
</pre></div>
</div>
<p>and restart the shell (or input those commands into your terminal). Download the package:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/XENON1T/pax.git
</pre></div>
</div>
<p>And finally set it up within your new environment:</p>
<div class="highlight-python"><div class="highlight"><pre>source activate &lt;name_of_your_environment&gt;
cd pax
python setup.py develop
</pre></div>
</div>
<p>If it complains about any more missing modules, install it using pip install (on xecluster01, within your environment).</p>
<p>Whichever way you want to use pax, you check that it worked using the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">paxer</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>which should result in Python3 being used to print the pax version.</p>
</div>
<div class="section" id="can-i-set-up-pax-on-my-windows-machine">
<h2>Can I set up pax on my windows machine?<a class="headerlink" href="#can-i-set-up-pax-on-my-windows-machine" title="Permalink to this headline">¶</a></h2>
<p>Yes, in fact several of the developers do this, much to the sadness of the other developers...</p>
<ol class="arabic simple">
<li>Start with installing Anaconda for python 3 from their website. If the Anaconda website nags you for an email,
enter your favourite fictional email address</li>
<li>Install python-snappy and h5py from <a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Christoph Gohlke&#8217;s page</a>.
See installation instructions for the .whl file at the top of the page.</li>
</ol>
<ol class="arabic simple" start="2">
<li>Get pax using Github&#8217;s nice point-and-click Github For Windows application.
Ignore the haters who insist on doing everything by command line.</li>
<li>Run <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">develop</span></code>.
It may complain about some failed module installations.
If it looks like an important module, try <cite>conda install important_module</cite>.
If that fails, try <cite>pip install important_module</cite>
If that fails, try <cite>easy_install important_module</cite>
If that fails, look for important_module on <a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Christoph Gohlke&#8217;s page</a>
If that fails, reboot, sacrifice a goat, then try again.</li>
<li>Go to bin and run <code class="docutils literal"><span class="pre">python</span> <span class="pre">paxer</span> <span class="pre">--plot</span></code>. If it shows a waveform plot, you are done.
If it complains about a missing module, I guess you shouldn&#8217;t have ignored those warnings in step 3,
install the missing module using easy_install, or Gohlke&#8217;s page mentioned above.</li>
</ol>
<p>Unfortunately, Windows + Python3 + Root is not exactly a winning team; if you use windows you&#8217;ll be stuck
with the other 433 output formats we have.</p>
</div>
<div class="section" id="how-do-i-get-pyroot-working">
<h2>How do I get pyROOT working<a class="headerlink" href="#how-do-i-get-pyroot-working" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>To use ROOT output from pax, you need to make sure pyROOT works. You have several options</dt>
<dd><ul class="first simple">
<li><strong>Use python 2.</strong> In this case, pyROOT should work (for windows only on ROOT 5). Just make sure the <cite>PYTHONPATH</cite> environment variable (which controls where python searches for libraries) is set to the directory containing ROOT.py.</li>
<li><strong>Use Daniela&#8217;s binaries with conda</strong> Daniela has packaged ROOT + pyROOT + rootpy in a conda package. Instructions on how to use it are here: <cite>https://github.com/rootpy/rootpy/issues/642#issuecomment-137389446</cite></li>
<li><strong>Use the travis scripts</strong> Before Daniela&#8217;s package, we made scripts to install ROOT on travis. Be sure that your GCC compiler version is more than 4.8 because ROOT requires that now. The scripts are here:</li>
</ul>
<p>source travis/linux_setup.sh  # Only run for Ubuntu
source travis/install-ROOT.sh</p>
<ul class="last simple">
<li><strong>Use Sander&#8217;s instructions</strong> Before those scripts, Sander made <a class="reference external" href="https://github.com/XENON1T/pax/blob/master/docs/pyroot.rst">these instructions</a>.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="how-do-i-install-snappy-on-osx">
<h2>How do I install Snappy on OSX?<a class="headerlink" href="#how-do-i-install-snappy-on-osx" title="Permalink to this headline">¶</a></h2>
<p>After instally <cite>snappy</cite> through MacPorts, please run:</p>
<div class="highlight-python"><div class="highlight"><pre>CFLAGS=-I/opt/local/include LDFLAGS=-L/opt/local/lib pip install python-snappy
</pre></div>
</div>
</div>
</div>
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-do-i-analyze-some-specific-xenon100-events-with-pax">
<h2>How do I analyze some specific XENON100 events with pax?<a class="headerlink" href="#how-do-i-analyze-some-specific-xenon100-events-with-pax" title="Permalink to this headline">¶</a></h2>
<p>Use the Dump_XENON100_events tool available here: <cite>https://github.com/XENON1T/XeAnalysisScripts/tree/master/PaxProcessingHelpers/DumpX100Events</cite></p>
</div>
<div class="section" id="how-do-i-use-pax-to-reduce-raw-data-files">
<h2>How do I use pax to reduce raw data files?<a class="headerlink" href="#how-do-i-use-pax-to-reduce-raw-data-files" title="Permalink to this headline">¶</a></h2>
<p>First, you need to know the event numbers of the events you want. Use whatever analysis tool you like for this.</p>
<p>If it is just a few events, you can use the <cite>&#8211;events</cite> switch like so:</p>
<div class="highlight-python"><div class="highlight"><pre>paxer --config reduce_raw_data --input your_dataset --output your_reduced_dataset --event 3 45 937 ...
</pre></div>
</div>
<p>This will produce your reduced raw data set in your_reduced_dataset. It will be in the ZippedBSON format, as that&#8217;s the only format that supports non-continuous event numbers (at least, for now).</p>
<p>If you want more than a few events, make a newline-separated file of event numbers like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">3</span>
<span class="mi">45</span>
<span class="mi">937</span>
<span class="o">...</span>
</pre></div>
</div>
<p>and save this as e.g. your_event_number_file.txt. Then use:</p>
<div class="highlight-python"><div class="highlight"><pre>paxer --config reduce_raw_data --input your_dataset --output your_reduced_dataset --event_numbers_file your_event_number_file.txt
</pre></div>
</div>
<p>If the dataset you want to reduce is not in the default input format (currently XED), you also want to give pax a configuration which overrides the read plugin with the read plugin of that format. For example, to reduce a ZippedBSON dataset, use:</p>
<div class="highlight-python"><div class="highlight"><pre>paxer --config ZippedBSON reduce_raw_data --input your_dataset --output your_reduced_dataset --event_numbers_file your_event_file.txt
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-reduce-the-file-size-of-my-processed-data">
<h2>How do I reduce the file size of my processed data?<a class="headerlink" href="#how-do-i-reduce-the-file-size-of-my-processed-data" title="Permalink to this headline">¶</a></h2>
<p>By default we store a lot of low-level information in the processed output files. If you need smaller files, first try to make &#8216;light&#8217; files using the reclassify configuration:</p>
<blockquote>
<div>paxer &#8211;config reclassify &#8211;input your_large_file.hdf5</div></blockquote>
<p>This will remove fields like the per-peak sum-waveform and hitpattern from the file, reducing the filesize significantly. You can remove more or less fields by playing with the fields_to_ignore option (see light_output.ini). Whatever you do with this field, put either <cite>all_hits</cite> or <cite>hits</cite> on it: <cite>&#8216;hits&#8217;</cite>  is a peak property which stores all the hits in a peak, <cite>all_hits</cite> is an event property which stores all hits. You don&#8217;t want both, and in fact you will get an error if you try.</p>
<p>If the files are still too big for you, try using a flattener (see XeAnalysisScripts, or write your own) to save only the main S1/S2 information. Or just select only events you need. Or just buy more disk space.</p>
</div>
<div class="section" id="how-do-i-use-pax-to-generate-xed-files-for-xerawdp-processing">
<h2>How do I use pax to generate XED files for Xerawdp processing?<a class="headerlink" href="#how-do-i-use-pax-to-generate-xed-files-for-xerawdp-processing" title="Permalink to this headline">¶</a></h2>
<p>Pax has an XED output plugin which you can use just like other output plugins. For example, to make an XED file containing simulated events, do <cite>paxer &#8211;config XENON100 Simulation to_XED</cite>.</p>
<p>The hard part is getting Xerawdp to read the XED file you produced. For a single XED file, here is a solution that works (or at least used to):</p>
<ul class="simple">
<li>Make some folder on xecluster to contain everything.</li>
<li>Make a subfolder <cite>raw</cite>, containing another subfolder <cite>xe100_150726_1253</cite> (I will keep using this dataset name, but you can of course put any date and time you want).</li>
<li>In the <cite>xe100_150726_1253</cite> folder, put the XED file generated by pax. Rename it to <cite>xe100_150726_1253.xed</cite>.</li>
<li>In the original folder, place the file <cite>xed_test.xml</cite> from pax&#8217;s <cite>examples</cite>. Edit it to replace any occurrence of <cite>/home/aalbers/xed_xdp_test</cite> with the absolute path to your folder.</li>
<li>Ssh to <cite>xecluster03</cite>, then run <cite>xerawdp -w xed_test.xml xe100_150726_1253</cite>. The ROOT file will appear at <cite>./processed/xe100_150726_1253/v0.4.5/xe100_150726_1253.root</cite>.</li>
<li>If you&#8217;d like to output the waveform of event 0 to .C instead, use <cite>xerawdp -p -o xed_test.xml xe100_150726_1253 0</cite>. The .C will appear in the current directory and can be opened by ROOT.</li>
</ul>
<p>At the moment our hacked XML only works for one XED file (which can contain an arbitrary number of events though), and the instructions aren&#8217;t very convenient. You&#8217;re welcome to improve the situation!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation and setup</a><ul>
<li><a class="reference internal" href="#setup-pycharm">Setup PyCharm</a></li>
<li><a class="reference internal" href="#how-do-i-use-pax-at-lngs-chicago-nikhef">How do I use <cite>pax</cite> at LNGS/Chicago/Nikhef?</a></li>
<li><a class="reference internal" href="#how-do-i-develop-for-pax-at-lngs">How do I develop for <cite>pax</cite> at LNGS?</a></li>
<li><a class="reference internal" href="#can-i-set-up-pax-on-my-windows-machine">Can I set up pax on my windows machine?</a></li>
<li><a class="reference internal" href="#how-do-i-get-pyroot-working">How do I get pyROOT working</a></li>
<li><a class="reference internal" href="#how-do-i-install-snappy-on-osx">How do I install Snappy on OSX?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#how-do-i-analyze-some-specific-xenon100-events-with-pax">How do I analyze some specific XENON100 events with pax?</a></li>
<li><a class="reference internal" href="#how-do-i-use-pax-to-reduce-raw-data-files">How do I use pax to reduce raw data files?</a></li>
<li><a class="reference internal" href="#how-do-i-reduce-the-file-size-of-my-processed-data">How do I reduce the file size of my processed data?</a></li>
<li><a class="reference internal" href="#how-do-i-use-pax-to-generate-xed-files-for-xerawdp-processing">How do I use pax to generate XED files for Xerawdp processing?</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="readme.html" title="previous chapter">Installation prerequisites</a></li>
      <li>Next: <a href="format.html" title="next chapter">Event format</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/faq.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, Christopher Tunnell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/faq.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>